---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library("lme4")
library("dplyr")
library("ggplot2")
library('sjPlot')
load(file="/Users/ghaeberle/scratch/data/FixEyeEEG/main/eyetracking/preprocessed/trials_wo_artefacts/df_all_subj_all_sacs_behav.Rda")

# rename1 column for better understanding of the models 
names(df_all_subj_all_sacs_behav)[names(df_all_subj_all_sacs_behav) == "cond"] <- "cross"

df_all_subj_all_sacs_behav$saccType <- ifelse(df_all_subj_all_sacs_behav$amplitude < 1, 'microsaccade', 'saccade')

df_all_subj_all_sacs_behav$cross = as.character(df_all_subj_all_sacs_behav$cross)
df_all_subj_all_sacs_behav$cross[df_all_subj_all_sacs_behav$cross == '1'] = 'bullseye' 
df_all_subj_all_sacs_behav$cross[df_all_subj_all_sacs_behav$cross == '2'] = 'standard' 
df_all_subj_all_sacs_behav$cross = as.factor(df_all_subj_all_sacs_behav$cross)

df_all_subj_all_sacs_behav$category = as.character(df_all_subj_all_sacs_behav$category)
df_all_subj_all_sacs_behav$category[df_all_subj_all_sacs_behav$category == '0'] = 'inanimate' 
df_all_subj_all_sacs_behav$category[df_all_subj_all_sacs_behav$category == '1'] = 'animate' 
df_all_subj_all_sacs_behav$category = as.factor(df_all_subj_all_sacs_behav$category)


# all saccades < 1 are classfied as microsaccades 
df_all_subj_microsaccades = df_all_subj_all_sacs_behav %>% filter(amplitude <1)
df_all_subj_saccades = df_all_subj_all_sacs_behav %>% filter(amplitude >= 1)

#create data frame for number of microsaccades 
df_n_all_saccades = as.data.frame(table(df_all_subj_all_sacs_behav$subj,df_all_subj_all_sacs_behav$trial, df_all_subj_all_sacs_behav$cross, df_all_subj_all_sacs_behav$saccType, df_all_subj_all_sacs_behav$category))
colnames(df_n_all_saccades) = c('subj','trial','cross','saccType','category','n_occurence')

df_n_microsaccades = df_n_all_saccades %>% filter(saccType == 'microsaccade')
df_n_saccades = df_n_all_saccades %>% filter(saccType ==  'saccade')
```
plotting the data to get a better overview 

First the main sequence
```{r}
ggplot(df_all_subj_all_sacs_behav, aes(x = peak_velocity, y =amplitude ))+
         geom_point()

ggplot(df_all_subj_all_sacs_behav, aes(x = amplitude, y = duration))+
         geom_point()
```
Then what we want to look at 
```{r}
ggplot(df_all_subj_all_sacs_behav, aes(y = amplitude,color=cross))+
         geom_violin()

ggplot(df_all_subj_microsaccades, aes(y = amplitude,color=cross))+
         geom_violin()

ggplot(df_all_subj_saccades, aes(y = amplitude,color=cross))+
         geom_violin()

ggplot(df_all_subj_all_sacs_behav, aes(y = amplitude, x=saccType, color=cross))+
         geom_violin() + 
  theme_bw()

ggsave("/Users/ghaeberle/scratch/data/FixEyeEEG/main/results/plots/eyetracking/amplitudes.png")
```
Then what we want to look at 
```{r}
ggplot(df_n_all_saccades, aes(y = n_occurence,color=cross))+
         geom_violin()

ggplot(df_all_subj_microsaccades, aes(y = amplitude,color=cross))+
         geom_violin()

ggplot(df_all_subj_saccades, aes(y = amplitude,color=cross))+
         geom_violin()
tmp = df_n_all_saccades %>% filter(n_occurence >20) %>% anti_join(df_n_all_saccades,.)
ggplot(df_n_all_saccades, aes(y = n_occurence, x=saccType, color=cross))+
         geom_violin() +
  theme_bw()
ggsave("/Users/ghaeberle/scratch/data/FixEyeEEG/main/results/plots/eyetracking/n_occurences.png")

```
amplitude model all saccades 
```{r}
contrasts(df_all_subj_all_sacs_behav$cross) = c(-0.5,0.5)
contrasts(df_all_subj_all_sacs_behav$category) = c(-0.5,0.5)

base_amplitude_all = lmer(amplitude ~ 1 + (1+cross|subj), df_all_subj_all_sacs_behav, REML = FALSE)
amplitude_all_cross = lmer(amplitude ~ 1 + cross + (1+cross|subj), df_all_subj_all_sacs_behav, REML = FALSE)
amplitude_all_category = lmer(amplitude ~ 1 + category + (1+cross|subj), df_all_subj_all_sacs_behav, REML = FALSE)
amplitude_all_cross_category = lmer(amplitude ~ 1 + cross+category + (1+cross|subj), df_all_subj_all_sacs_behav, REML = FALSE)
amplitude_all_cross_category_interaction = lmer(amplitude ~ 1 + cross*category + (1+cross|subj), df_all_subj_all_sacs_behav, REML = FALSE)

anova(base_amplitude_all, amplitude_all_cross)
anova(base_amplitude_all, amplitude_all_category)
anova(amplitude_all_cross, amplitude_all_cross_category)
anova(amplitude_all_cross_category, amplitude_all_cross_category_interaction)
plot_model(amplitude_all_cross_category_interaction) +
  theme_bw()
``` 

amplitude model microsaccades 
```{r}
contrasts(df_all_subj_microsaccades$cross) = c(-0.5,0.5)
contrasts(df_all_subj_microsaccades$category) = c(-0.5,0.5)

base_amplitude_ms = lmer(amplitude ~ 1 + (1+cross|subj), df_all_subj_microsaccades, REML = FALSE)
amplitude_ms_cross = lmer(amplitude ~ 1 + cross + (1+cross|subj), df_all_subj_microsaccades, REML = FALSE)
amplitude_ms_category = lmer(amplitude ~ 1 + category + (1+cross|subj), df_all_subj_microsaccades, REML = FALSE)
amplitude_ms_cross_category = lmer(amplitude ~ 1 + cross+category + (1+cross|subj), df_all_subj_microsaccades, REML = FALSE)
amplitude_ms_cross_category_interaction = lmer(amplitude ~ 1 + cross*category + (1+cross|subj), df_all_subj_microsaccades, REML = FALSE)

anova(base_amplitude_ms, amplitude_ms_cross)
anova(base_amplitude_ms, amplitude_ms_category)
anova(amplitude_ms_cross, amplitude_ms_cross_category)
anova(amplitude_ms_cross_category, amplitude_ms_cross_category_interaction)


```
amplitude model saccades 
```{r}
contrasts(df_all_subj_saccades$cross) = c(-0.5,0.5)
contrasts(df_all_subj_saccades$category) = c(-0.5,0.5)

base_amplitude_sac = lmer(amplitude ~ 1 + (1+cross|subj), df_all_subj_saccades, REML = FALSE)
amplitude_sac_cross = lmer(amplitude ~ 1 + cross + (1+cross|subj), df_all_subj_saccades, REML = FALSE)
amplitude_sac_category = lmer(amplitude ~ 1 + category + (1+cross|subj), df_all_subj_saccades, REML = FALSE)
amplitude_sac_cross_category = lmer(amplitude ~ 1 + cross+category + (1+cross|subj), df_all_subj_saccades, REML = FALSE)
amplitude_sac_cross_category_interaction = lmer(amplitude ~ 1 + cross*category + (1+cross|subj), df_all_subj_saccades, REML = FALSE)

anova(base_amplitude_sac, amplitude_sac_cross)
anova(base_amplitude_sac, amplitude_sac_category)
anova(amplitude_sac_cross, amplitude_sac_cross_category)
anova(amplitude_sac_cross_category, amplitude_sac_cross_category_interaction)
summary(amplitude_sac_cross_category_interaction)
summary(amplitude_ms_category_condition_interaction)
summary(amplitude_all_cross_category_interaction)
```
n_occurence saccade models 
```{r}
# set contrast coding to effect coding as we are interested in the main effects 
contrasts(df_n_all_saccades$cross) = c(-0.5,0.5)
contrasts(df_n_all_saccades$category) = c(-0.5,0.5)

# #these would be the full models which do not converge 
# base_n_saccades = lmer(n_occurence ~ 1 + (1+cross+category|subj), df_n_saccades, REML = FALSE)
# summary(base_n_saccades)
# cross_n_saccades = lmer(n_occurence ~ 1 + cross + (1+cross+category|subj), df_n_saccades, REML = FALSE)
# cross_category_n_microsaccades = lmer(n_occurence ~ 1 + cross + category + (1+cross+category|subj), df_n_microsaccades, REML = FALSE)
# cross_category_interaction_n_microsaccades = lmer(n_occurence ~ 1 + cross * category + (1+cross*category|subj), df_n_microsaccades, REML = FALSE)

# these models converge 
base_n_all_saccades = lmer(n_occurence ~ 1 + (1+cross|subj), df_n_all_saccades, REML = FALSE)
cross_n_all_saccades = lmer(n_occurence ~ 1 + cross + (1+cross|subj), df_n_all_saccades, REML = FALSE)
category_n_all_saccades = lmer(n_occurence ~ 1 + category + (1+cross|subj), df_n_all_saccades, REML = FALSE)
cross_category_n_all_saccades = lmer(n_occurence ~ 1 + cross + category+(1+cross|subj), df_n_all_saccades, REML = FALSE)
cross_category_interaction_n_all_saccades = lmer(n_occurence ~ 1 + cross * category+(1+cross|subj), df_n_all_saccades, REML = FALSE)

summary(cross_n_all_saccades)
anova(base_n_all_saccades,cross_n_all_saccades)
anova(base_n_all_saccades,category_n_all_saccades)
anova(cross_n_all_saccades,cross_category_n_all_saccades)
anova(cross_category_n_all_saccades,cross_category_interaction_n_all_saccades)
summary(cross_category_interaction_n_all_saccades)
```

n_occurence model microsaccades 
```{r}
# microsaccades 
# set contrast coding to effect coding as we are interested in the main effects 
contrasts(df_n_microsaccades$cross) = c(-0.5,0.5)
contrasts(df_n_microsaccades$category) = c(-0.5,0.5)

#these would be the full models which do not converge 
base_n_microsaccades = lmer(n_occurence ~ 1 + (1+cross+category|subj), df_n_microsaccades, REML = FALSE)
summary(base_n_microsaccades)
cross_n_microsaccades = lmer(n_occurence ~ 1 + cross + (1+cross+category|subj), df_n_microsaccades, REML = FALSE)
cross_category_n_microsaccades = lmer(n_occurence ~ 1 + cross + category + (1+cross+category|subj), df_n_microsaccades, REML = FALSE)
cross_category_interaction_n_microsaccades = lmer(n_occurence ~ 1 + cross * category + (1+cross*category|subj), df_n_microsaccades, REML = FALSE)

# these models converge 
base_n_microsaccades = lmer(n_occurence ~ 1 + (1+cross|subj), df_n_microsaccades, REML = FALSE)
cross_n_microsaccades = lmer(n_occurence ~ 1 + cross + (1+cross|subj), df_n_microsaccades, REML = FALSE)
category_n_microsaccades = lmer(n_occurence ~ 1 + category + (1+cross|subj), df_n_microsaccades, REML = FALSE)
cross_category_n_microsaccades = lmer(n_occurence ~ 1 + cross + category+(1+cross|subj), df_n_microsaccades, REML = FALSE)
cross_category_interaction_n_microsaccades = lmer(n_occurence ~ 1 + cross * category+(1+cross|subj), df_n_microsaccades, REML = FALSE)

summary(cross_n_microsaccades)
anova(base_n_microsaccades,cross_n_microsaccades)
anova(base_n_microsaccades,category_n_microsaccades)
anova(cross_n_microsaccades,cross_category_n_microsaccades)
anova(cross_category_n_microsaccades,cross_category_interaction_n_microsaccades)
summary(cross_category_interaction_n_microsaccades)
```

n_occurence saccade models 
```{r}
# set contrast coding to effect coding as we are interested in the main effects 
contrasts(df_n_saccades$cross) = c(-0.5,0.5)
contrasts(df_n_saccades$category) = c(-0.5,0.5)

# #these would be the full models which do not converge 
# base_n_saccades = lmer(n_occurence ~ 1 + (1+cross+category|subj), df_n_saccades, REML = FALSE)
# summary(base_n_saccades)
# cross_n_saccades = lmer(n_occurence ~ 1 + cross + (1+cross+category|subj), df_n_saccades, REML = FALSE)
# cross_category_n_microsaccades = lmer(n_occurence ~ 1 + cross + category + (1+cross+category|subj), df_n_microsaccades, REML = FALSE)
# cross_category_interaction_n_microsaccades = lmer(n_occurence ~ 1 + cross * category + (1+cross*category|subj), df_n_microsaccades, REML = FALSE)

# these models converge 
base_n_saccades = lmer(n_occurence ~ 1 + (1+cross|subj), df_n_saccades, REML = FALSE)
cross_n_saccades = lmer(n_occurence ~ 1 + cross + (1+cross|subj), df_n_saccades, REML = FALSE)
category_n_saccades = lmer(n_occurence ~ 1 + category + (1+cross|subj), df_n_saccades, REML = FALSE)
cross_category_n_saccades = lmer(n_occurence ~ 1 + cross + category+(1+cross|subj), df_n_saccades, REML = FALSE)
cross_category_interaction_n_saccades = lmer(n_occurence ~ 1 + cross * category+(1+cross|subj), df_n_saccades, REML = FALSE)

summary(cross_n_saccades)
summary(cross_category_n_saccades)
summary(cross_category_interaction_n_saccades)
anova(base_n_saccades,cross_n_saccades)
anova(base_n_saccades,category_n_saccades)
anova(cross_n_saccades,cross_category_n_saccades)
anova(cross_category_n_saccades,cross_category_interaction_n_saccades)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

plot random effects 
```{r}
plot_model(cross_category_interaction_n_saccades, type = "re",vline.color = "red", axis.title = "pair", ci.lvl = 0.95, transform = NULL, grid = FALSE) 
plot_model(cross_category_interaction_n_microsaccades, type = "re",vline.color = "red", axis.title = "pair", ci.lvl = 0.95, transform = NULL, grid = FALSE) 
plot_model(cross_category_interaction_n_all_saccades, type = "re",vline.color = "red", axis.title = "pair", ci.lvl = 0.95, transform = NULL, grid = FALSE) 

plot_model(amplitude_sac_cross_category_interaction, type = "re",vline.color = "red", axis.title = "pair", ci.lvl = 0.95, transform = NULL, grid = FALSE)
plot_model(amplitude_ms_cross_category_interaction, type = "re",vline.color = "red", axis.title = "pair", ci.lvl = 0.95, transform = NULL, grid = FALSE) 
plot_model(amplitude_all_cross_category_interaction, type = "re",vline.color = "red", axis.title = "pair", ci.lvl = 0.95, transform = NULL, grid = FALSE)

```

